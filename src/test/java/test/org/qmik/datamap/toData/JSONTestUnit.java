package test.org.qmik.datamap.toData;

import java.util.Map;

import org.qmik.qmikjson.JSON;

public class JSONTestUnit {
	
	private static int	maxJson	= 50000;
	private static int	dealSum	= 1;
	private static int	arrays	= 10;
	
	public static void testJSON2Map() {
		//String json = "{\"code\":\"200\",\"etag\":\"\",\"header\":{},\"body\":{\"kb80\":\"80\",\"kb89\":\"89\",\"kb83\":\"83\",\"kb84\":\"84\",\"kb81\":\"81\",\"kb82\":\"82\",\"kb87\":\"87\",\"kb88\":\"88\",\"kb85\":\"85\",\"kb86\":\"86\",\"kb91\":\"91\",\"kb90\":\"90\",\"kb92\":\"92\",\"kb93\":\"93\",\"kb94\":\"94\",\"kb95\":\"95\",\"kb96\":\"96\",\"kb97\":\"97\",\"kb98\":\"98\",\"kb99\":\"99\",\"kb40\":\"40\",\"kb44\":\"44\",\"kb43\":\"43\",\"kb42\":\"42\",\"kb41\":\"41\",\"kb48\":\"48\",\"kb47\":\"47\",\"kb46\":\"46\",\"kb45\":\"45\",\"kb49\":\"49\",\"kb51\":\"51\",\"kb50\":\"50\",\"kb53\":\"53\",\"kb52\":\"52\",\"kb55\":\"55\",\"kb54\":\"54\",\"kb57\":\"57\",\"kb56\":\"56\",\"kb59\":\"59\",\"kb58\":\"58\",\"kb66\":\"66\",\"kb65\":\"65\",\"kb64\":\"64\",\"kb63\":\"63\",\"kb62\":\"62\",\"kb61\":\"61\",\"kb60\":\"60\",\"kb69\":\"69\",\"kb68\":\"68\",\"kb67\":\"67\",\"kb75\":\"75\",\"kb74\":\"74\",\"kb77\":\"77\",\"kb76\":\"76\",\"kb71\":\"71\",\"kb70\":\"70\",\"kb73\":\"73\",\"kb72\":\"72\",\"kb79\":\"79\",\"kb78\":\"78\",\"kb109\":\"109\",\"kb108\":\"108\",\"kb107\":\"107\",\"kb106\":\"106\",\"kb111\":\"111\",\"kb112\":\"112\",\"kb110\":\"110\",\"kb115\":\"115\",\"kb116\":\"116\",\"kb113\":\"113\",\"kb114\":\"114\",\"kb118\":\"118\",\"kb117\":\"117\",\"kb119\":\"119\",\"kb120\":\"120\",\"kb121\":\"121\",\"kb122\":\"122\",\"kb123\":\"123\",\"kb124\":\"124\",\"kb125\":\"125\",\"kb126\":\"126\",\"kb127\":\"127\",\"kb102\":\"102\",\"kb103\":\"103\",\"kb104\":\"104\",\"kb105\":\"105\",\"kb100\":\"100\",\"kb101\":\"101\",\"kb152\":\"152\",\"kb151\":\"151\",\"kb150\":\"150\",\"kb156\":\"156\",\"kb155\":\"155\",\"kb154\":\"154\",\"kb153\":\"153\",\"kb159\":\"159\",\"kb158\":\"158\",\"kb157\":\"157\",\"kb161\":\"161\",\"kb160\":\"160\",\"kb163\":\"163\",\"kb162\":\"162\",\"kb165\":\"165\",\"kb164\":\"164\",\"kb167\":\"167\",\"kb166\":\"166\",\"kb169\":\"169\",\"kb168\":\"168\",\"kb128\":\"128\",\"kb129\":\"129\",\"kb130\":\"130\",\"kb291\":\"291\",\"kb290\":\"290\",\"kb295\":\"295\",\"kb294\":\"294\",\"kb293\":\"293\",\"kb292\":\"292\",\"kb138\":\"138\",\"kb299\":\"299\",\"kb137\":\"137\",\"kb298\":\"298\",\"kb136\":\"136\",\"kb297\":\"297\",\"kb135\":\"135\",\"kb296\":\"296\",\"kb134\":\"134\",\"kb133\":\"133\",\"kb132\":\"132\",\"kb131\":\"131\",\"kb139\":\"139\",\"kb141\":\"141\",\"kb140\":\"140\",\"kb147\":\"147\",\"kb146\":\"146\",\"kb149\":\"149\",\"kb148\":\"148\",\"kb143\":\"143\",\"kb142\":\"142\",\"kb145\":\"145\",\"kb144\":\"144\",\"kb287\":\"287\",\"kb382\":\"382\",\"kb288\":\"288\",\"kb383\":\"383\",\"kb285\":\"285\",\"kb380\":\"380\",\"kb286\":\"286\",\"kb381\":\"381\",\"kb289\":\"289\",\"kb280\":\"280\",\"kb388\":\"388\",\"kb389\":\"389\",\"kb386\":\"386\",\"kb283\":\"283\",\"kb387\":\"387\",\"kb284\":\"284\",\"kb384\":\"384\",\"kb281\":\"281\",\"kb385\":\"385\",\"kb282\":\"282\",\"kb482\":\"482\",\"kb481\":\"481\",\"kb480\":\"480\",\"kb486\":\"486\",\"kb485\":\"485\",\"kb484\":\"484\",\"kb483\":\"483\",\"kb489\":\"489\",\"kb488\":\"488\",\"kb487\":\"487\",\"kb469\":\"469\",\"kb274\":\"274\",\"kb275\":\"275\",\"kb370\":\"370\",\"kb276\":\"276\",\"kb371\":\"371\",\"kb277\":\"277\",\"kb372\":\"372\",\"kb197\":\"197\",\"kb278\":\"278\",\"kb198\":\"198\",\"kb279\":\"279\",\"kb199\":\"199\",\"kb193\":\"193\",\"kb377\":\"377\",\"kb194\":\"194\",\"kb378\":\"378\",\"kb195\":\"195\",\"kb379\":\"379\",\"kb196\":\"196\",\"kb270\":\"270\",\"kb373\":\"373\",\"kb190\":\"190\",\"kb271\":\"271\",\"kb374\":\"374\",\"kb191\":\"191\",\"kb272\":\"272\",\"kb375\":\"375\",\"kb192\":\"192\",\"kb273\":\"273\",\"kb376\":\"376\",\"kb471\":\"471\",\"kb470\":\"470\",\"kb473\":\"473\",\"kb472\":\"472\",\"kb475\":\"475\",\"kb474\":\"474\",\"kb477\":\"477\",\"kb476\":\"476\",\"kb479\":\"479\",\"kb478\":\"478\",\"kb188\":\"188\",\"kb269\":\"269\",\"kb189\":\"189\",\"kb186\":\"186\",\"kb267\":\"267\",\"kb187\":\"187\",\"kb268\":\"268\",\"kb265\":\"265\",\"kb266\":\"266\",\"kb458\":\"458\",\"kb263\":\"263\",\"kb459\":\"459\",\"kb264\":\"264\",\"kb180\":\"180\",\"kb261\":\"261\",\"kb181\":\"181\",\"kb262\":\"262\",\"kb260\":\"260\",\"kb184\":\"184\",\"kb185\":\"185\",\"kb182\":\"182\",\"kb183\":\"183\",\"kb460\":\"460\",\"kb468\":\"468\",\"kb467\":\"467\",\"kb466\":\"466\",\"kb465\":\"465\",\"kb464\":\"464\",\"kb463\":\"463\",\"kb462\":\"462\",\"kb461\":\"461\",\"kb175\":\"175\",\"kb256\":\"256\",\"kb176\":\"176\",\"kb257\":\"257\",\"kb177\":\"177\",\"kb258\":\"258\",\"kb390\":\"390\",\"kb178\":\"178\",\"kb259\":\"259\",\"kb447\":\"447\",\"kb391\":\"391\",\"kb179\":\"179\",\"kb252\":\"252\",\"kb448\":\"448\",\"kb392\":\"392\",\"kb253\":\"253\",\"kb449\":\"449\",\"kb393\":\"393\",\"kb254\":\"254\",\"kb394\":\"394\",\"kb255\":\"255\",\"kb395\":\"395\",\"kb396\":\"396\",\"kb397\":\"397\",\"kb250\":\"250\",\"kb398\":\"398\",\"kb170\":\"170\",\"kb251\":\"251\",\"kb399\":\"399\",\"kb171\":\"171\",\"kb172\":\"172\",\"kb173\":\"173\",\"kb174\":\"174\",\"kb455\":\"455\",\"kb454\":\"454\",\"kb457\":\"457\",\"kb456\":\"456\",\"kb451\":\"451\",\"kb450\":\"450\",\"kb249\":\"249\",\"kb453\":\"453\",\"kb452\":\"452\",\"kb347\":\"347\",\"kb346\":\"346\",\"kb345\":\"345\",\"kb344\":\"344\",\"kb240\":\"240\",\"kb343\":\"343\",\"kb342\":\"342\",\"kb341\":\"341\",\"kb340\":\"340\",\"kb244\":\"244\",\"kb243\":\"243\",\"kb242\":\"242\",\"kb241\":\"241\",\"kb248\":\"248\",\"kb247\":\"247\",\"kb246\":\"246\",\"kb245\":\"245\",\"kb238\":\"238\",\"kb239\":\"239\",\"kb339\":\"339\",\"kb337\":\"337\",\"kb338\":\"338\",\"kb334\":\"334\",\"kb333\":\"333\",\"kb336\":\"336\",\"kb335\":\"335\",\"kb330\":\"330\",\"kb332\":\"332\",\"kb331\":\"331\",\"kb231\":\"231\",\"kb230\":\"230\",\"kb233\":\"233\",\"kb232\":\"232\",\"kb235\":\"235\",\"kb234\":\"234\",\"kb237\":\"237\",\"kb236\":\"236\",\"kb227\":\"227\",\"kb228\":\"228\",\"kb229\":\"229\",\"kb326\":\"326\",\"kb327\":\"327\",\"kb328\":\"328\",\"kb329\":\"329\",\"kb365\":\"365\",\"kb364\":\"364\",\"kb363\":\"363\",\"kb362\":\"362\",\"kb369\":\"369\",\"kb368\":\"368\",\"kb367\":\"367\",\"kb366\":\"366\",\"kb226\":\"226\",\"kb225\":\"225\",\"kb224\":\"224\",\"kb223\":\"223\",\"kb222\":\"222\",\"kb361\":\"361\",\"kb221\":\"221\",\"kb360\":\"360\",\"kb220\":\"220\",\"kb218\":\"218\",\"kb219\":\"219\",\"kb216\":\"216\",\"kb217\":\"217\",\"kb359\":\"359\",\"kb352\":\"352\",\"kb351\":\"351\",\"kb354\":\"354\",\"kb353\":\"353\",\"kb356\":\"356\",\"kb355\":\"355\",\"kb358\":\"358\",\"kb357\":\"357\",\"kb213\":\"213\",\"kb212\":\"212\",\"kb215\":\"215\",\"kb214\":\"214\",\"kb211\":\"211\",\"kb350\":\"350\",\"kb210\":\"210\",\"kb498\":\"498\",\"kb209\":\"209\",\"kb499\":\"499\",\"kb494\":\"494\",\"kb205\":\"205\",\"kb495\":\"495\",\"kb206\":\"206\",\"kb496\":\"496\",\"kb207\":\"207\",\"kb497\":\"497\",\"kb208\":\"208\",\"kb490\":\"490\",\"kb348\":\"348\",\"kb491\":\"491\",\"kb349\":\"349\",\"kb492\":\"492\",\"kb493\":\"493\",\"kb18\":\"18\",\"kb19\":\"19\",\"kb16\":\"16\",\"kb17\":\"17\",\"kb14\":\"14\",\"kb15\":\"15\",\"kb12\":\"12\",\"kb13\":\"13\",\"kb10\":\"10\",\"kb11\":\"11\",\"kb400\":\"400\",\"kb402\":\"402\",\"kb401\":\"401\",\"kb200\":\"200\",\"kb201\":\"201\",\"kb202\":\"202\",\"kb203\":\"203\",\"kb204\":\"204\",\"kb300\":\"300\",\"kb301\":\"301\",\"kb302\":\"302\",\"kb303\":\"303\",\"kb9\":\"9\",\"kb8\":\"8\",\"kb7\":\"7\",\"kb36\":\"36\",\"kb316\":\"316\",\"kb37\":\"37\",\"kb0\":\"0\",\"kb315\":\"315\",\"kb34\":\"34\",\"kb1\":\"1\",\"kb318\":\"318\",\"kb35\":\"35\",\"kb2\":\"2\",\"kb317\":\"317\",\"kb3\":\"3\",\"kb4\":\"4\",\"kb319\":\"319\",\"kb38\":\"38\",\"kb5\":\"5\",\"kb39\":\"39\",\"kb6\":\"6\",\"kb32\":\"32\",\"kb33\":\"33\",\"kb30\":\"30\",\"kb31\":\"31\",\"kb320\":\"320\",\"kb321\":\"321\",\"kb322\":\"322\",\"kb323\":\"323\",\"kb324\":\"324\",\"kb325\":\"325\",\"kb23\":\"23\",\"kb307\":\"307\",\"kb24\":\"24\",\"kb306\":\"306\",\"kb25\":\"25\",\"kb305\":\"305\",\"kb26\":\"26\",\"kb304\":\"304\",\"kb27\":\"27\",\"kb28\":\"28\",\"kb29\":\"29\",\"kb309\":\"309\",\"kb308\":\"308\",\"kb20\":\"20\",\"kb21\":\"21\",\"kb22\":\"22\",\"kb310\":\"310\",\"kb313\":\"313\",\"kb314\":\"314\",\"kb311\":\"311\",\"kb312\":\"312\",\"kb440\":\"440\",\"kb441\":\"441\",\"kb442\":\"442\",\"kb443\":\"443\",\"kb444\":\"444\",\"kb445\":\"445\",\"kb446\":\"446\",\"kb437\":\"437\",\"kb436\":\"436\",\"kb439\":\"439\",\"kb438\":\"438\",\"kb430\":\"430\",\"kb431\":\"431\",\"kb434\":\"434\",\"kb435\":\"435\",\"kb432\":\"432\",\"kb433\":\"433\",\"kb428\":\"428\",\"kb427\":\"427\",\"kb426\":\"426\",\"kb425\":\"425\",\"kb429\":\"429\",\"kb421\":\"421\",\"kb422\":\"422\",\"kb423\":\"423\",\"kb424\":\"424\",\"kb420\":\"420\",\"kb419\":\"419\",\"kb418\":\"418\",\"kb415\":\"415\",\"kb414\":\"414\",\"kb417\":\"417\",\"kb416\":\"416\",\"kb412\":\"412\",\"kb413\":\"413\",\"kb410\":\"410\",\"kb411\":\"411\",\"kb409\":\"409\",\"kb408\":\"408\",\"kb407\":\"407\",\"kb406\":\"406\",\"kb405\":\"405\",\"kb404\":\"404\",\"kb403\":\"403\"}}";
		//String json = "\"T\":{\"C\":\"2\",\"E\":\"x\", \"L\":[\"1\", \"2\",{\"P\":\"p\",\"L1\":[\"1\",{\"O\":\"o\"}]},\"3\"],\"H\":{\"A\":\"3\",\"N\":\"n\",\"W\":{\"X\":\"x\",\"G\":\"g\",\"Q\":{}}},\"B\":{\"H\":\"9\"}}";
		String json = "{\"1A\":\"V1中文}A\",\"1U\":\"12\",\"\":[] ,\"1B\":\"V1}B\", \"1L\":[\"V2A\", \"V2}B\",{\"3A\":\"V3}A\",\"3B\":[\"V4A\",{\"5A\":\"V5A\"}]},{\"3M\":\"V3M\",\"3N\":\"V3N\"},\"V2C\"],\"1H\":{\"2X\":\"V2X\",\"2Y\":\"V2Y\",\"2Z\":{\"3X\":\"V3X\",\"3Y\":\"V3Y\",\"3Z\":{}}},\"1K\":{\"2K\":\"V2K\"}}";
		//String json = "[{\"1A\":\"V1A\",\"1U\":\"12\",\"1M\":[] ,\"1B\":\"V1B\", \"1L\":[\"V2A\", \"V2}B\",{\"3A\":\"V3}A\",\"3B\":[\"V4A\",{\"5A\":\"V5A\"}]},{\"3M\":\"V3M\",\"3N\":\"V3N\"},\"V2C\"],\"1H\":{\"2X\":\"V2X\",\"2Y\":\"V2Y\",\"2Z\":{\"3X\":\"V3X\",\"3Y\":\"V3Y\",\"3Z\":{}}},\"1K\":{\"2K\":\"V2K\"}}]";
		System.out.println(JSON.parse(json));
		long s1=System.currentTimeMillis();
		for(int i=0;i<1;i++){
			JSON.parse(json);
		}
		System.out.println("+++++++++++TTL:"+(System.currentTimeMillis()-s1));
		System.out.println("length:" + json.length());
		System.out.println(json);
		System.out.println(JSON.parse(json));
		/*		Object value = null;
				long log1 = System.currentTimeMillis();
				for (int i = 0; i < dealSum1; i++) {
					//value = JSON.parse(json);
					value = com.alibaba.fastjson.JSON.parseObject(json, Map.class);
				}
				long log2 = System.currentTimeMillis();
				System.out.println("time:" + (log2 - log1));
				System.out.println("out:" + value);
				
				System.out.println("qjson:\t\t" + JSON.parse(json));
				System.out.println("fastjson:\t" + com.alibaba.fastjson.JSON.parse(json));*/
		
		System.out.println("================================================================");
		testQJSON(new String[] { json });
		testFastJSON(new String[] { json });
		
		System.out.println("================================================================");
		String[] jsons = createJSONS();
		testQJSON(jsons);
		testFastJSON(jsons);
		
		System.out.println(JSON.parse(jsons[0]));
	}
	
	public static void testQJSON(String[] jsons) {
		System.out.println("qjson:"+jsons[0]);
		System.out.println("qjson: length:\t\t" + jsons[0].length() + "---个数" + maxJson + "---循环次数:" + dealSum + "----" + jsons[0]);
		long log1 = System.currentTimeMillis();
		for (int i = 0; i < dealSum; i++) {
			for (String str : jsons) {
				JSON.parse(str);
			}
		}
		long log2 = System.currentTimeMillis();
		System.out.println("qjson time\t\t" + (log2 - log1));
		System.out.println(JSON.parse(jsons[0]));
	}
	
	public static void testFastJSON(String[] jsons) {
		System.out.println("fastjson: length:\t" + jsons[0].length() + "---个数" + maxJson + "---循环次数:" + dealSum + "----" + jsons[0]);
		
		long log1 = System.currentTimeMillis();
		
		for (int i = 0; i < dealSum; i++) {
			for (String str : jsons) {
				com.alibaba.fastjson.JSON.parseObject(str, Map.class);
			}
		}
		long log2 = System.currentTimeMillis();
		System.out.println("fastjson time\t\t" + (log2 - log1));
	}
	
	public static String[] createJSONS() {
		String tmp;
		String[] jsons = new String[maxJson];
		StringBuffer sb = new StringBuffer();
		int itecount = arrays;
		for (int i = 0; i < jsons.length; i++) {
			sb = new StringBuffer();
			sb.append("{");
			for (int j = 0; j < itecount; j++) {
				tmp = (i + "-" + j + (int) (Math.random() * 100000)) + ((char) (65 + (Math.random() * 26))) + "";
				sb.append("\"").append("" + tmp).append("\":\"").append(Math.random()).append("\"");
				if (j < itecount - 1) {
					sb.append(",");
				}
			}
			sb.append("}");
			jsons[i] = sb.toString();
		}
		
		return jsons;
	}
	
}
